{% extends "base.html" %}

{% block title %}AI Command Center - Flavorio Pro{% endblock %}

{% block additional_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
    .ai-command-center {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
    }
    
    .quantum-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }
    
    .quantum-card:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .ai-metric {
        text-align: center;
        padding: 1rem;
    }
    
    .ai-metric-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #00ff88;
        text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }
    
    .ai-metric-label {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-top: 0.5rem;
    }
    
    .quantum-button {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        border: none;
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        font-weight: bold;
        transition: all 0.3s ease;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .quantum-button:hover {
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .neural-network-viz {
        position: relative;
        height: 200px;
        overflow: hidden;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.3);
    }
    
    .neuron {
        position: absolute;
        width: 10px;
        height: 10px;
        background: #00ff88;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 0.5; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.2); }
    }
    
    .quantum-field {
        background: radial-gradient(circle, rgba(0, 255, 136, 0.1) 0%, transparent 70%);
        position: absolute;
        width: 100%;
        height: 100%;
        animation: quantum-fluctuation 3s infinite alternate;
    }
    
    @keyframes quantum-fluctuation {
        0% { transform: rotate(0deg) scale(1); }
        100% { transform: rotate(360deg) scale(1.1); }
    }
    
    .prediction-confidence {
        position: relative;
        height: 20px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        overflow: hidden;
    }
    
    .confidence-bar {
        height: 100%;
        background: linear-gradient(90deg, #ff6b6b 0%, #feca57 50%, #00ff88 100%);
        border-radius: 10px;
        transition: width 1s ease;
    }
    
    .ai-status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
        animation: blink 1s infinite;
    }
    
    .status-optimal { background: #00ff88; }
    .status-warning { background: #feca57; }
    .status-error { background: #ff6b6b; }
    
    @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0.3; }
    }
    
    .quantum-panel {
        background: linear-gradient(135deg, rgba(106, 17, 203, 0.1) 0%, rgba(37, 117, 252, 0.1) 100%);
        border: 1px solid rgba(106, 17, 203, 0.3);
        border-radius: 15px;
        padding: 2rem;
        margin: 1rem 0;
    }
    
    .ai-terminal {
        background: #0a0a0a;
        color: #00ff88;
        font-family: 'Courier New', monospace;
        padding: 1rem;
        border-radius: 10px;
        height: 300px;
        overflow-y: auto;
        font-size: 0.9rem;
    }
    
    .terminal-line {
        margin: 0.5rem 0;
    }
    
    .terminal-prompt {
        color: #4ecdc4;
    }
    
    .ml-model-card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1rem 0;
        transition: all 0.3s ease;
    }
    
    .ml-model-card:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: #00ff88;
    }
    
    .accuracy-meter {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 0 auto;
    }
    
    .accuracy-circle {
        transform: rotate(-90deg);
    }
    
    .accuracy-background {
        fill: none;
        stroke: rgba(255, 255, 255, 0.2);
        stroke-width: 8;
    }
    
    .accuracy-progress {
        fill: none;
        stroke: #00ff88;
        stroke-width: 8;
        stroke-linecap: round;
        transition: stroke-dasharray 2s ease;
    }
    
    .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 4px solid #00ff88;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
{% endblock %}

{% block content %}
<div class="ai-command-center">
    <div class="container-fluid">
        <!-- Header Section -->
        <div class="row py-4">
            <div class="col-12">
                <div class="quantum-card">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="mb-3">
                                <i class="fas fa-brain me-3"></i>
                                AI Command Center
                                <span class="badge bg-success ms-2">Pro</span>
                            </h1>
                            <p class="lead mb-0">
                                Ultra-Advanced Predictive Analytics • Quantum-Inspired Optimization • Enterprise AI
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="ai-status-indicator status-optimal"></div>
                            <span>All Systems Optimal</span>
                            <br>
                            <small class="opacity-75">Last Updated: <span id="last-update-time">{{ datetime.now().strftime('%H:%M:%S') }}</span></small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Metrics Dashboard -->
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="quantum-card ai-metric">
                    <div class="ai-metric-value" id="total-items">{{ ai_insights.items_analyzed or ai_insights.total_items or 0 }}</div>
                    <div class="ai-metric-label">Items Analyzed</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="quantum-card ai-metric">
                    <div class="ai-metric-value text-{{ 'danger' if ai_insights.total_alerts > 5 else 'warning' if ai_insights.total_alerts > 0 else 'success' }}" id="total-alerts">{{ ai_insights.total_alerts or 0 }}</div>
                    <div class="ai-metric-label">AI Alerts</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="quantum-card ai-metric">
                    <div class="ai-metric-value" id="prediction-accuracy">{{ ai_insights.prediction_accuracy or 85.0 }}%</div>
                    <div class="ai-metric-label">Prediction Accuracy</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="quantum-card ai-metric">
                    <div class="ai-metric-value text-{{ 'danger' if ai_insights.low_stock_warnings > 3 else 'warning' if ai_insights.low_stock_warnings > 0 else 'success' }}">{{ ai_insights.low_stock_warnings or 0 }}</div>
                    <div class="ai-metric-label">Low Stock Items</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="quantum-card ai-metric">
                    <div class="ai-metric-value text-{{ 'danger' if ai_insights.recipe_conflicts > 0 else 'success' }}">{{ ai_insights.recipe_conflicts or 0 }}</div>
                    <div class="ai-metric-label">Recipe Conflicts</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="quantum-card ai-metric">
                    <div class="ai-metric-value">
                        <i class="fas fa-{{ 'check-circle text-success' if ai_insights.total_alerts == 0 else 'exclamation-triangle text-warning' if ai_insights.total_alerts < 3 else 'times-circle text-danger' }}"></i>
                    </div>
                    <div class="ai-metric-label">System Status</div>
                </div>
            </div>
        </div>

        <!-- Critical AI Alerts Section -->
        {% if ai_insights.warnings or ai_insights.conflicts %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="quantum-card" style="border-left: 4px solid #ff6b6b;">
                    <h4><i class="fas fa-exclamation-triangle me-2 text-danger"></i>Critical AI Alerts</h4>
                    
                    {% if ai_insights.warnings %}
                    <div class="alert-section mb-3">
                        <h6><i class="fas fa-battery-quarter me-2 text-warning"></i>Low Stock Warnings</h6>
                        {% for warning in ai_insights.warnings %}
                        <div class="alert alert-warning d-flex align-items-center mb-2">
                            <i class="fas fa-clock me-2"></i>
                            <strong>{{ warning.item }}</strong> is running low - only <strong>{{ warning.days_left|round(1) }} days</strong> remaining
                            <span class="badge bg-{{ 'danger' if warning.urgency == 'HIGH' else 'warning' }} ms-auto">{{ warning.urgency }}</span>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    {% if ai_insights.conflicts %}
                    <div class="alert-section">
                        <h6><i class="fas fa-utensils me-2 text-danger"></i>Recipe Ingredient Conflicts</h6>
                        {% for conflict in ai_insights.conflicts %}
                        <div class="alert alert-danger d-flex align-items-center mb-2">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <div class="flex-grow-1">
                                <strong>{{ conflict.ingredient }}</strong>: Need <strong>{{ conflict.needed }}</strong> but only have <strong>{{ conflict.available }}</strong>
                                <br><small>Shortfall: {{ conflict.shortfall }} - Affects: {{ conflict.affected_meals|join(', ') }}</small>
                            </div>
                            <span class="badge bg-danger">CRITICAL</span>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row">
            <!-- Left Column - Neural Network Visualization -->
            <div class="col-md-4">
                <div class="quantum-card">
                    <h4><i class="fas fa-project-diagram me-2"></i>Neural Network Status</h4>
                    <div class="neural-network-viz" id="neural-viz">
                        <div class="quantum-field"></div>
                        <!-- Neurons will be dynamically added here -->
                    </div>
                    <div class="mt-3">
                        <div class="row">
                            <div class="col-6">
                                <small>Input Layers</small>
                                <div class="prediction-confidence">
                                    <div class="confidence-bar" style="width: 95%"></div>
                                </div>
                            </div>
                            <div class="col-6">
                                <small>Output Accuracy</small>
                                <div class="prediction-confidence">
                                    <div class="confidence-bar" style="width: 94%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Model Performance -->
                <div class="quantum-card mt-3">
                    <h5><i class="fas fa-cogs me-2"></i>Active AI Models</h5>
                    <div class="ml-model-card">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <strong>Quantum Optimizer</strong>
                                <br><small>Superposition States: 1000+</small>
                            </div>
                            <div class="col-4 text-end">
                                <div class="accuracy-meter">
                                    <svg width="50" height="50" class="accuracy-circle">
                                        <circle cx="25" cy="25" r="20" class="accuracy-background"></circle>
                                        <circle cx="25" cy="25" r="20" class="accuracy-progress" 
                                                stroke-dasharray="125.6" stroke-dashoffset="12.56"></circle>
                                    </svg>
                                </div>
                                <small>92%</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ml-model-card">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <strong>Neural Predictor</strong>
                                <br><small>Deep Learning: 8 Layers</small>
                            </div>
                            <div class="col-4 text-end">
                                <div class="accuracy-meter">
                                    <svg width="50" height="50" class="accuracy-circle">
                                        <circle cx="25" cy="25" r="20" class="accuracy-background"></circle>
                                        <circle cx="25" cy="25" r="20" class="accuracy-progress" 
                                                stroke-dasharray="125.6" stroke-dashoffset="6.28"></circle>
                                    </svg>
                                </div>
                                <small>95%</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ml-model-card">
                        <div class="row align-items-center">
                            <div class="col-8">
                                <strong>Ensemble Meta-Learner</strong>
                                <br><small>Adaptive Algorithms: 5</small>
                            </div>
                            <div class="col-4 text-end">
                                <div class="accuracy-meter">
                                    <svg width="50" height="50" class="accuracy-circle">
                                        <circle cx="25" cy="25" r="20" class="accuracy-background"></circle>
                                        <circle cx="25" cy="25" r="20" class="accuracy-progress" 
                                                stroke-dasharray="125.6" stroke-dashoffset="3.14"></circle>
                                    </svg>
                                </div>
                                <small>97%</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Column - Prediction Dashboard -->
            <div class="col-md-4">
                <div class="quantum-card">
                    <h4><i class="fas fa-chart-line me-2"></i>Consumption Predictions</h4>
                    <canvas id="consumption-chart" width="400" height="300"></canvas>
                    <div class="mt-3">
                        <button class="quantum-button btn-sm me-2" onclick="updatePredictions()">
                            <i class="fas fa-sync-alt me-1"></i>Refresh Predictions
                        </button>
                        <button class="quantum-button btn-sm" onclick="runQuantumOptimization()">
                            <i class="fas fa-atom me-1"></i>Quantum Optimize
                        </button>
                    </div>
                </div>

                <!-- Smart Recommendations -->
                <div class="quantum-card mt-3">
                    <h5><i class="fas fa-lightbulb me-2"></i>AI Recommendations</h5>
                    <div id="ai-recommendations">
                        <div class="alert alert-info bg-transparent border-info text-white mb-2">
                            <i class="fas fa-robot me-2"></i>
                            Quantum optimization suggests bulk purchase opportunity
                        </div>
                        <div class="alert alert-warning bg-transparent border-warning text-white mb-2">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            3 items approaching reorder point
                        </div>
                        <div class="alert alert-success bg-transparent border-success text-white mb-0">
                            <i class="fas fa-check-circle me-2"></i>
                            Machine learning detected efficiency improvement
                        </div>
                    </div>
                </div>

                <!-- Quantum Control Panel -->
                <div class="quantum-panel mt-3">
                    <h6><i class="fas fa-atom me-2"></i>Quantum Computing Controls</h6>
                    <div class="row">
                        <div class="col-6">
                            <label class="form-label small">Temperature</label>
                            <input type="range" class="form-range" id="quantum-temperature" 
                                   min="0.1" max="2.0" step="0.1" value="1.0">
                            <small id="temp-value">1.0K</small>
                        </div>
                        <div class="col-6">
                            <label class="form-label small">Coherence</label>
                            <input type="range" class="form-range" id="quantum-coherence" 
                                   min="0.5" max="1.0" step="0.05" value="0.85">
                            <small id="coherence-value">85%</small>
                        </div>
                    </div>
                    <button class="quantum-button btn-sm mt-2 w-100" onclick="calibrateQuantumSystem()">
                        <i class="fas fa-cog me-1"></i>Calibrate Quantum System
                    </button>
                </div>
            </div>

            <!-- Right Column - Terminal & Advanced Controls -->
            <div class="col-md-4">
                <div class="quantum-card">
                    <h4><i class="fas fa-terminal me-2"></i>AI System Console</h4>
                    <div class="ai-terminal" id="ai-terminal">
                        <div class="terminal-line">
                            <span class="terminal-prompt">AI@Flavorio:~$</span> initializing predictive systems...
                        </div>
                        <div class="terminal-line">
                            <span class="text-success">[OK]</span> Neural networks online
                        </div>
                        <div class="terminal-line">
                            <span class="text-success">[OK]</span> Machine learning models loaded
                        </div>
                        <div class="terminal-line">
                            <span class="text-info">[ANALYSIS]</span> Scanning {{ ai_insights.total_items }} pantry items
                        </div>
                        {% if ai_insights.items_analyzed > 0 %}
                        <div class="terminal-line">
                            <span class="text-success">[PREDICT]</span> Generated predictions for {{ ai_insights.items_analyzed }} items
                        </div>
                        <div class="terminal-line">
                            <span class="text-info">[ACCURACY]</span> Confidence: {{ ai_insights.prediction_accuracy|round(1) }}%
                        </div>
                        {% endif %}
                        {% if ai_insights.low_stock_warnings > 0 %}
                        <div class="terminal-line">
                            <span class="text-warning">[WARNING]</span> {{ ai_insights.low_stock_warnings }} items running low
                        </div>
                        {% endif %}
                        {% if ai_insights.recipe_conflicts > 0 %}
                        <div class="terminal-line">
                            <span class="text-danger">[ALERT]</span> {{ ai_insights.recipe_conflicts }} recipe conflicts detected
                        </div>
                        {% endif %}
                        {% if ai_insights.total_alerts == 0 %}
                        <div class="terminal-line">
                            <span class="text-success">[STATUS]</span> All systems optimal - no alerts
                        </div>
                        {% else %}
                        <div class="terminal-line">
                            <span class="text-warning">[STATUS]</span> {{ ai_insights.total_alerts }} alerts require attention
                        </div>
                        {% endif %}
                        </div>
                        <div class="terminal-line">
                            <span class="terminal-prompt">AI@Flavorio:~$</span> <span class="cursor">_</span>
                        </div>
                    </div>
                </div>

                <!-- Advanced Analytics -->
                <div class="quantum-card mt-3">
                    <h5><i class="fas fa-microscope me-2"></i>Advanced Analytics</h5>
                    <div class="row">
                        <div class="col-6 text-center">
                            <div class="ai-metric-value text-info">0.23ms</div>
                            <small>Processing Speed</small>
                        </div>
                        <div class="col-6 text-center">
                            <div class="ai-metric-value text-success">99.8%</div>
                            <small>System Uptime</small>
                        </div>
                    </div>
                    <hr class="opacity-25">
                    <div class="row">
                        <div class="col-6 text-center">
                            <div class="ai-metric-value text-warning">87.2</div>
                            <small>Data Quality Score</small>
                        </div>
                        <div class="col-6 text-center">
                            <div class="ai-metric-value text-primary">1000+</div>
                            <small>Quantum States</small>
                        </div>
                    </div>
                </div>

                <!-- System Health -->
                <div class="quantum-card mt-3">
                    <h6><i class="fas fa-heartbeat me-2"></i>System Health Monitor</h6>
                    <div class="mb-2">
                        <small>Neural Network Performance</small>
                        <div class="prediction-confidence">
                            <div class="confidence-bar" style="width: 96%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <small>Quantum Coherence Stability</small>
                        <div class="prediction-confidence">
                            <div class="confidence-bar" style="width: 85%"></div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <small>Machine Learning Accuracy</small>
                        <div class="prediction-confidence">
                            <div class="confidence-bar" style="width: 94%"></div>
                        </div>
                    </div>
                    <button class="quantum-button btn-sm w-100 mt-2" onclick="runSystemDiagnostics()">
                        <i class="fas fa-stethoscope me-1"></i>Run Full Diagnostics
                    </button>
                </div>
            </div>
        </div>

        <!-- Additional Panels Row -->
        <div class="row mt-4">
            <!-- Pantry Items Analysis -->
            <div class="col-md-6">
                <div class="quantum-card">
                    <h5><i class="fas fa-warehouse me-2"></i>Intelligent Pantry Analysis</h5>
                    <div class="table-responsive" style="max-height: 300px;">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Quantity</th>
                                    <th>AI Prediction</th>
                                    <th>Confidence</th>
                                </tr>
                            </thead>
                            <tbody id="pantry-analysis-table">
                                {% if ai_insights.ai_predictions %}
                                    {% for prediction in ai_insights.ai_predictions[:10] %}
                                    <tr>
                                        <td>{{ prediction.item_name }}</td>
                                        <td>{{ prediction.current_quantity }}</td>
                                        <td>
                                            {% if prediction.predicted_days_remaining <= 1 %}
                                                <span class="badge bg-danger">
                                                    <i class="fas fa-exclamation-triangle"></i> 
                                                    {{ prediction.predicted_days_remaining|round(1) }} days left
                                                </span>
                                            {% elif prediction.predicted_days_remaining <= 3 %}
                                                <span class="badge bg-warning">
                                                    <i class="fas fa-clock"></i>
                                                    {{ prediction.predicted_days_remaining|round(1) }} days left
                                                </span>
                                            {% else %}
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check"></i>
                                                    {{ prediction.predicted_days_remaining|round(1) }} days left
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <div class="prediction-confidence">
                                                <div class="confidence-bar" style="width: {{ prediction.confidence }}%"></div>
                                            </div>
                                            <small class="text-muted">{{ prediction.confidence|round(1) }}%</small>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    {% for item in pantry_items[:10] %}
                                    <tr>
                                        <td>{{ item.name }}</td>
                                        <td>{{ item.current_quantity }}</td>
                                        <td>
                                            <span class="badge bg-secondary">Insufficient data</span>
                                        </td>
                                        <td>
                                            <div class="prediction-confidence">
                                                <div class="confidence-bar" style="width: 50%"></div>
                                            </div>
                                            <small class="text-muted">Learning...</small>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Real-time Activity Feed -->
            <div class="col-md-6">
                <div class="quantum-card">
                    <h5><i class="fas fa-rss me-2"></i>Real-time AI Activity</h5>
                    <div id="activity-feed" style="max-height: 300px; overflow-y: auto;">
                        {% for log in recent_logs %}
                        <div class="d-flex align-items-center mb-2 p-2 rounded" style="background: rgba(255,255,255,0.05);">
                            <div class="me-3">
                                <i class="fas fa-brain text-primary"></i>
                            </div>
                            <div class="flex-grow-1">
                                <small>
                                    <strong>{{ log.item.name if log.item else 'Unknown Item' }}</strong>
                                    {{ 'consumed' if log.quantity_change < 0 else 'added' }}
                                    <span class="text-info">{{ log.quantity_change|abs }}</span>
                                    {% if log.reason %}
                                    <span class="text-muted">- {{ log.reason }}</span>
                                    {% endif %}
                                </small>
                                <br>
                                <small class="text-muted">{{ log.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white border-0">
            <div class="modal-body text-center p-4">
                <div class="loading-spinner mb-3"></div>
                <h5>Processing with AI Systems</h5>
                <p class="mb-0">Quantum algorithms analyzing data...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
// Initialize neural network visualization
function initializeNeuralViz() {
    const neuralViz = document.getElementById('neural-viz');
    const neurons = 20;
    
    for (let i = 0; i < neurons; i++) {
        const neuron = document.createElement('div');
        neuron.className = 'neuron';
        neuron.style.left = Math.random() * 90 + '%';
        neuron.style.top = Math.random() * 90 + '%';
        neuron.style.animationDelay = Math.random() * 2 + 's';
        neuralViz.appendChild(neuron);
    }
}

// Initialize consumption chart
function initializeConsumptionChart() {
    const ctx = document.getElementById('consumption-chart').getContext('2d');
    
    // Generate sample data
    const labels = [];
    const data = [];
    for (let i = 0; i < 30; i++) {
        const date = new Date();
        date.setDate(date.getDate() + i);
        labels.push(date.toLocaleDateString());
        data.push(Math.random() * 10 + 5);
    }
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Predicted Consumption',
                data: data,
                borderColor: '#00ff88',
                backgroundColor: 'rgba(0, 255, 136, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: {
                        color: 'white'
                    }
                }
            },
            scales: {
                x: {
                    ticks: { color: 'white' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                },
                y: {
                    ticks: { color: 'white' },
                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                }
            }
        }
    });
}

// Update predictions
function updatePredictions() {
    showLoading('Updating AI predictions...');
    
    fetch('/api/hyper-predictions')
        .then(response => response.json())
        .then(data => {
            hideLoading();
            if (data.success) {
                addTerminalLine('[INFO] Predictions updated successfully');
                addTerminalLine('[STATUS] Confidence: ' + (data.global_insights.average_confidence * 100).toFixed(1) + '%');
                updatePantryAnalysisTable(data.predictions);
            } else {
                addTerminalLine('[ERROR] Prediction update failed: ' + data.error);
            }
        })
        .catch(error => {
            hideLoading();
            addTerminalLine('[ERROR] Network error: ' + error.message);
        });
}

// Run quantum optimization
function runQuantumOptimization() {
    showLoading('Running quantum optimization...');
    
    fetch('/api/quantum-optimization?budget=100')
        .then(response => response.json())
        .then(data => {
            hideLoading();
            if (data.success) {
                addTerminalLine('[QUANTUM] Optimization complete');
                addTerminalLine('[QUANTUM] Advantage: ' + (data.quantum_advantage * 100).toFixed(1) + '%');
                addTerminalLine('[QUANTUM] Confidence: ' + (data.confidence_score * 100).toFixed(1) + '%');
                
                // Update quantum advantage metric
                document.getElementById('quantum-advantage').textContent = (data.quantum_advantage * 100).toFixed(1) + '%';
            } else {
                addTerminalLine('[ERROR] Quantum optimization failed: ' + data.error);
            }
        })
        .catch(error => {
            hideLoading();
            addTerminalLine('[ERROR] Quantum decoherence detected: ' + error.message);
        });
}

// Calibrate quantum system
function calibrateQuantumSystem() {
    const temperature = document.getElementById('quantum-temperature').value;
    const coherence = document.getElementById('quantum-coherence').value;
    
    addTerminalLine('[QUANTUM] Calibrating system...');
    addTerminalLine('[QUANTUM] Temperature: ' + temperature + 'K');
    addTerminalLine('[QUANTUM] Coherence: ' + (coherence * 100).toFixed(0) + '%');
    
    setTimeout(() => {
        addTerminalLine('[QUANTUM] Calibration complete');
    }, 2000);
}

// Run system diagnostics
function runSystemDiagnostics() {
    showLoading('Running comprehensive diagnostics...');
    
    fetch('/api/ai-health-check')
        .then(response => response.json())
        .then(data => {
            hideLoading();
            if (data.success) {
                addTerminalLine('[DIAG] System health check complete');
                addTerminalLine('[DIAG] Overall status: ' + data.overall_status);
                addTerminalLine('[DIAG] Model accuracy: ' + data.health_status.model_accuracy + '%');
                addTerminalLine('[DIAG] System load: ' + data.health_status.system_load);
            } else {
                addTerminalLine('[ERROR] Diagnostics failed: ' + data.error);
            }
        })
        .catch(error => {
            hideLoading();
            addTerminalLine('[ERROR] Diagnostic error: ' + error.message);
        });
}

// Terminal functions
function addTerminalLine(text) {
    const terminal = document.getElementById('ai-terminal');
    const line = document.createElement('div');
    line.className = 'terminal-line';
    line.innerHTML = '<span class="text-info">[' + new Date().toLocaleTimeString() + ']</span> ' + text;
    terminal.insertBefore(line, terminal.lastElementChild);
    terminal.scrollTop = terminal.scrollHeight;
    
    // Keep only last 20 lines
    const lines = terminal.querySelectorAll('.terminal-line');
    if (lines.length > 21) {
        lines[0].remove();
    }
}

// Update pantry analysis table
function updatePantryAnalysisTable(predictions) {
    const tbody = document.getElementById('pantry-analysis-table');
    if (!tbody) return;
    
    tbody.querySelectorAll('tr').forEach((row, index) => {
        const predictionCell = row.cells[2];
        const confidenceCell = row.cells[3];
        
        if (predictions && Object.keys(predictions).length > index) {
            const prediction = Object.values(predictions)[index];
            if (prediction && prediction.final_recommendation) {
                const rate = prediction.final_recommendation.final_daily_consumption_rate;
                predictionCell.innerHTML = `<span class="badge bg-success">${rate.toFixed(2)}/day</span>`;
                
                const confidence = prediction.confidence_score * 100;
                confidenceCell.innerHTML = `
                    <div class="prediction-confidence">
                        <div class="confidence-bar" style="width: ${confidence}%"></div>
                    </div>
                `;
            }
        }
    });
}

// Utility functions
function showLoading(message = 'Processing...') {
    const modal = document.getElementById('loadingModal');
    modal.querySelector('p').textContent = message;
    new bootstrap.Modal(modal).show();
}

function hideLoading() {
    const modal = bootstrap.Modal.getInstance(document.getElementById('loadingModal'));
    if (modal) modal.hide();
}

// Update time
function updateTime() {
    document.getElementById('last-update-time').textContent = new Date().toLocaleTimeString();
}

// Quantum control sliders
document.getElementById('quantum-temperature').addEventListener('input', function() {
    document.getElementById('temp-value').textContent = this.value + 'K';
});

document.getElementById('quantum-coherence').addEventListener('input', function() {
    document.getElementById('coherence-value').textContent = Math.round(this.value * 100) + '%';
});

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeNeuralViz();
    initializeConsumptionChart();
    
    // Update time every second
    setInterval(updateTime, 1000);
    
    // Auto-refresh predictions every 30 seconds
    setInterval(updatePredictions, 30000);
    
    // Add some initial terminal activity
    setTimeout(() => addTerminalLine('[AI] Real-time monitoring active'), 2000);
    setTimeout(() => addTerminalLine('[ML] Pattern recognition online'), 4000);
    setTimeout(() => addTerminalLine('[QUANTUM] Superposition states stable'), 6000);
});
</script>
{% endblock %}
