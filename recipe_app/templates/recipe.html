{% extends "base.html" %}

{% block title %}{{ recipe.title }} - HomeGrubHub{% endblock %}

{% block content %}
<div class="container mt-4" id="recipe-data" data-rate-url="{{ url_for('main.rate_recipe', recipe_id=recipe.id) }}" data-comment-url="{{ url_for('community.add_comment', recipe_id=recipe.id) }}">
    <h1>{{ recipe.title }}</h1>
    {% if recipe.description %}
    <p class="text-muted">{{ recipe.description }}</p>
    {% endif %}

    <div class="mb-3">
        {% set avg = avg_rating %}
        <div>
            {% for i in range(5) %}
                <i class="fa{% if i < avg|round(0, 'floor') %}s{% else %}r{% endif %} fa-star text-warning"></i>
            {% endfor %}
            <strong>{{ '%.1f' % avg }}</strong>
            <small class="text-muted">({{ rating_count }} ratings)</small>
        </div>
        {% if current_user.is_authenticated %}
        <div class="mt-2">
            <span>Rate this recipe:</span>
            <span id="rate-widget">
            {% for i in range(1,6) %}
                <i class="far fa-star text-warning rate-star" data-value="{{ i }}"></i>
            {% endfor %}
            </span>
        </div>
        {% endif %}
    </div>

    <h3>Ingredients</h3>
    <pre>{{ recipe.ingredients }}</pre>
    <h3>Method</h3>
    <pre>{{ recipe.method }}</pre>

    <div id="comments" class="mt-5">
        <h3>Comments</h3>
        <div id="comment-list">
            {% from "_comment.html" import render_comment %}
            {% for comment in comments %}
                {{ render_comment(comment) }}
            {% endfor %}
        </div>
        {% if current_user.is_authenticated %}
        <div class="mt-3">
            <textarea id="new-comment" class="form-control" rows="3" placeholder="Add a comment"></textarea>
            <button class="btn btn-primary mt-2" id="submit-comment">Post Comment</button>
        </div>
        {% else %}
        <p><a href="{{ url_for('main.login') }}">Log in</a> to comment.</p>
        {% endif %}
    </div>
    </div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/recipe-detail.js') }}" defer></script>
{% endblock %}
