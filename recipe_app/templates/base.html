<!doctype html>
<html lang="en" class="h-100">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- SEO Meta Tags -->
    <title>{% block seo_title %}{% if title %}{{ title }} - HomeGrubHub{% else %}HomeGrubHub - Smart Meal Planning & Recipe Organization App{% endif %}{% endblock %}</title>
    <meta name="description" content="{% block seo_description %}Plan meals, track nutrition, and organize recipes with HomeGrubHub. Save time and money with smart shopping lists and family meal planning tools. Free trial available.{% endblock %}">
    <meta name="keywords" content="{% block seo_keywords %}meal planning app, recipe organizer, nutrition tracker, grocery list generator, meal prep planner, healthy eating app, family meal planning, budget cooking{% endblock %}">
    <meta name="author" content="HomeGrubHub">
    <meta name="robots" content="{% block seo_robots %}index, follow{% endblock %}">
    <link rel="canonical" href="{% block canonical_url %}{{ request.url }}{% endblock %}">
    
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="{% block og_title %}{% if title %}{{ title }} - HomeGrubHub{% else %}HomeGrubHub - Smart Meal Planning App{% endif %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Transform your cooking with intelligent meal planning, recipe organization, and nutrition tracking. Join thousands of families saving time and money.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{{ url_for('static', filename='images/og-image.jpg', _external=True) }}{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ request.url }}{% endblock %}">
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:site_name" content="HomeGrubHub">
    <meta property="og:locale" content="en_GB">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@HomeGrubHub">
    <meta name="twitter:creator" content="@HomeGrubHub">
    <meta name="twitter:title" content="{% block twitter_title %}{% if title %}{{ title }} - HomeGrubHub{% else %}HomeGrubHub - Smart Meal Planning App{% endif %}{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Transform your cooking with intelligent meal planning, recipe organization, and nutrition tracking.{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{{ url_for('static', filename='images/twitter-card.jpg', _external=True) }}{% endblock %}">
    
    <!-- Structured Data (Schema.org) -->
    {% block structured_data %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "HomeGrubHub",
      "description": "Comprehensive meal planning and recipe organization application",
      "url": "{{ url_for('main.index', _external=True) }}",
      "applicationCategory": "LifestyleApplication",
      "operatingSystem": "Web Browser",
      "browserRequirements": "HTML5, CSS3, JavaScript",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "GBP",
        "category": "Free with Premium Options"
      },
      "creator": {
        "@type": "Organization",
        "name": "HomeGrubHub",
        "url": "{{ url_for('main.index', _external=True) }}"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "250",
        "bestRating": "5",
        "worstRating": "1"
      }
    }
    </script>
    {% endblock %}
    
    <!-- Preconnect to External Resources for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Favicon Setup -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='HomeGrubHub.ico') }}" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='HomeGrubHub.png') }}">
    <meta name="msapplication-TileImage" content="{{ url_for('static', filename='HomeGrubHub.png') }}">
    <meta name="msapplication-TileColor" content="#2c3e50">
    <meta name="theme-color" content="#2c3e50">
    
    <!-- CSRF Token for AJAX requests -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HomeGrubHub">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="HomeGrubHub">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='icons/icon-512x512.png') }}">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    
    {% block extra_styles %}{% endblock %}
    <!-- Google tag (gtag.js) -->
    <!-- Google tag (gtag.js) -->


    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MNLSSL2G');</script>
    <!-- End Google Tag Manager -->

  <!-- Microsoft Clarity -->
  <script type="text/javascript">
    try {
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "spkvz4fsic");
    } catch(e) {
      // Clarity blocked by ad blocker - fail silently
      console.log('Microsoft Clarity not loaded (likely blocked by ad blocker)');
    }
  </script>

  <!-- Cookie Consent -->
  <script type="text/javascript">
    let cookieBanner = null;
    let cookieModal = null;
    
    window.addEventListener('load', function() {
      if (!localStorage.getItem('cookieConsent')) {
        createCookieBanner();
        createCookieModal();
      }
    });

    function createCookieBanner() {
      cookieBanner = document.createElement('div');
      cookieBanner.id = 'cookie-consent-banner';
      cookieBanner.innerHTML = `
        <div style="position: fixed; bottom: 0; left: 0; right: 0; background: #2c3e50; color: white; padding: 15px; z-index: 9999; font-family: Arial, sans-serif; box-shadow: 0 -2px 10px rgba(0,0,0,0.1);">
          <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;">
            <div style="flex: 1; margin-right: 20px; min-width: 300px;">
              <strong>üç™ We use cookies to improve your experience</strong><br>
              <small>We use cookies for essential functionality and analytics. Click 'Customise' to see what cookies we use and manage your preferences.</small>
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
              <button id="accept-all-cookies-btn" style="background: #27ae60; color: white; border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s ease;">Accept All</button>
              <button id="reject-all-cookies-btn" style="background: #e74c3c; color: white; border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s ease;">Reject All</button>
              <button id="customise-cookies-btn" style="background: transparent; color: white; border: 1px solid white; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: all 0.3s ease;">Customise</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(cookieBanner);
      
      // Add event listeners to buttons
      document.getElementById('accept-all-cookies-btn').addEventListener('click', acceptAllCookies);
      document.getElementById('reject-all-cookies-btn').addEventListener('click', rejectAllCookies);
      document.getElementById('customise-cookies-btn').addEventListener('click', showCookieModal);
      
      // Add hover effects
      const acceptBtn = document.getElementById('accept-all-cookies-btn');
      const rejectBtn = document.getElementById('reject-all-cookies-btn');
      const customiseBtn = document.getElementById('customise-cookies-btn');
      
      acceptBtn.addEventListener('mouseenter', function() {
        this.style.backgroundColor = '#229954';
      });
      acceptBtn.addEventListener('mouseleave', function() {
        this.style.backgroundColor = '#27ae60';
      });
      
      rejectBtn.addEventListener('mouseenter', function() {
        this.style.backgroundColor = '#c0392b';
      });
      rejectBtn.addEventListener('mouseleave', function() {
        this.style.backgroundColor = '#e74c3c';
      });
      
      customiseBtn.addEventListener('mouseenter', function() {
        this.style.backgroundColor = 'rgba(255,255,255,0.1)';
      });
      customiseBtn.addEventListener('mouseleave', function() {
        this.style.backgroundColor = 'transparent';
      });
    }

    function createCookieModal() {
      cookieModal = document.createElement('div');
      cookieModal.id = 'cookie-modal';
      cookieModal.style.display = 'none';
      cookieModal.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px; font-family: Arial, sans-serif;">
          <div style="background: white; border-radius: 12px; max-width: 600px; max-height: 90vh; overflow-y: auto; width: 100%;">
            <div style="padding: 25px; border-bottom: 1px solid #eee;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; color: #2c3e50;">Cookie Settings</h3>
                <button id="close-modal-btn" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999; line-height: 1;">&times;</button>
              </div>
            </div>
            <div style="padding: 25px;">
              <p style="margin: 0 0 20px 0; color: #555;">We use cookies to enhance your experience on Home Grub Hub. Below are the types of cookies we use and their purposes under UK law:</p>
              
              <div style="margin-bottom: 25px; border: 1px solid #e3e3e3; border-radius: 8px; padding: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50; display: flex; align-items: center; justify-content: space-between;">
                  <span>üîí Essential Cookies</span>
                  <span style="font-size: 12px; background: #e74c3c; color: white; padding: 3px 8px; border-radius: 12px; font-weight: normal;">Required</span>
                </h4>
                <p style="margin: 0 0 10px 0; color: #666; font-size: 14px;">These cookies are necessary for the website to function properly. They cannot be disabled.</p>
                <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                  <li>Session management and user authentication</li>
                  <li>Security and fraud prevention</li>
                  <li>Shopping basket functionality</li>
                  <li>Form data retention during browsing</li>
                </ul>
              </div>
              
              <div style="margin-bottom: 25px; border: 1px solid #e3e3e3; border-radius: 8px; padding: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50; display: flex; align-items: center; justify-content: space-between;">
                  <span>üìä Analytics Cookies</span>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="analytics-cookies" style="margin-right: 8px;">
                    <span style="font-size: 12px; font-weight: normal;">Enable</span>
                  </label>
                </h4>
                <p style="margin: 0 0 10px 0; color: #666; font-size: 14px;">Help us understand how you use our website to improve your experience.</p>
                <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                  <li><strong>Google Analytics:</strong> Page views, user journeys, popular content</li>
                  <li><strong>Microsoft Clarity:</strong> User session recordings and heatmaps</li>
                  <li>Site performance monitoring and error tracking</li>
                  <li>Understanding user preferences and behaviour</li>
                </ul>
              </div>
              
              <div style="margin-bottom: 25px; border: 1px solid #e3e3e3; border-radius: 8px; padding: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50; display: flex; align-items: center; justify-content: space-between;">
                  <span>‚öôÔ∏è Functional Cookies</span>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="functional-cookies" style="margin-right: 8px;">
                    <span style="font-size: 12px; font-weight: normal;">Enable</span>
                  </label>
                </h4>
                <p style="margin: 0 0 10px 0; color: #666; font-size: 14px;">Remember your preferences to personalise your experience.</p>
                <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                  <li>Remembering your meal planning preferences</li>
                  <li>Storing your dietary requirements and restrictions</li>
                  <li>Language and region preferences</li>
                  <li>Theme and display settings</li>
                </ul>
              </div>
              
              <div style="margin-bottom: 25px; border: 1px solid #e3e3e3; border-radius: 8px; padding: 20px;">
                <h4 style="margin: 0 0 15px 0; color: #2c3e50; display: flex; align-items: center; justify-content: space-between;">
                  <span>üéØ Marketing Cookies</span>
                  <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="marketing-cookies" style="margin-right: 8px;">
                    <span style="font-size: 12px; font-weight: normal;">Enable</span>
                  </label>
                </h4>
                <p style="margin: 0 0 10px 0; color: #666; font-size: 14px;">Used to show you relevant content and advertisements.</p>
                <ul style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
                  <li>Personalised recipe recommendations</li>
                  <li>Relevant promotional content</li>
                  <li>Social media integration features</li>
                  <li>Third-party advertising partnerships</li>
                </ul>
              </div>
              
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <h5 style="margin: 0 0 10px 0; color: #2c3e50;">Your Rights Under UK Law</h5>
                <p style="margin: 0; font-size: 14px; color: #666;">
                  Under UK GDPR and PECR regulations, you have the right to control how cookies are used on your device. 
                  You can change these settings at any time by accessing this panel again through our 
                  <a href="{{ url_for('main.cookie_policy') }}" target="_blank" style="color: #007bff;">Cookie Policy</a> page.
                </p>
              </div>
            </div>
            <div style="padding: 20px 25px; border-top: 1px solid #eee; display: flex; gap: 10px; justify-content: flex-end;">
              <button id="save-preferences-btn" style="background: #27ae60; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s ease;">Save Preferences</button>
              <button id="accept-all-modal-btn" style="background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s ease;">Accept All</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(cookieModal);
      
      // Add event listeners for modal
      document.getElementById('close-modal-btn').addEventListener('click', hideCookieModal);
      document.getElementById('save-preferences-btn').addEventListener('click', saveCustomPreferences);
      document.getElementById('accept-all-modal-btn').addEventListener('click', acceptAllFromModal);
      
      // Close modal when clicking outside
      cookieModal.addEventListener('click', function(e) {
        if (e.target === cookieModal) {
          hideCookieModal();
        }
      });
      
      // Set default preferences
      document.getElementById('analytics-cookies').checked = true;
      document.getElementById('functional-cookies').checked = true;
      document.getElementById('marketing-cookies').checked = false;
    }

    function showCookieModal() {
      cookieModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }
    
    function hideCookieModal() {
      cookieModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    function acceptAllCookies() {
      const preferences = {
        essential: true,
        analytics: true,
        functional: true,
        marketing: true
      };
      saveCookiePreferences('accepted', preferences);
      removeCookieBanner();
    }

    function rejectAllCookies() {
      const preferences = {
        essential: true, // Essential cookies cannot be disabled
        analytics: false,
        functional: false,
        marketing: false
      };
      saveCookiePreferences('declined', preferences);
      removeCookieBanner();
    }
    
    function acceptAllFromModal() {
      document.getElementById('analytics-cookies').checked = true;
      document.getElementById('functional-cookies').checked = true;
      document.getElementById('marketing-cookies').checked = true;
      saveCustomPreferences();
    }
    
    function saveCustomPreferences() {
      const preferences = {
        essential: true, // Always true
        analytics: document.getElementById('analytics-cookies').checked,
        functional: document.getElementById('functional-cookies').checked,
        marketing: document.getElementById('marketing-cookies').checked
      };
      
      const consentStatus = (preferences.analytics || preferences.functional || preferences.marketing) ? 'custom' : 'minimal';
      saveCookiePreferences(consentStatus, preferences);
      hideCookieModal();
      removeCookieBanner();
    }
    
    function saveCookiePreferences(status, preferences) {
      localStorage.setItem('cookieConsent', status);
      localStorage.setItem('cookieConsentDate', new Date().toISOString());
      localStorage.setItem('cookiePreferences', JSON.stringify(preferences));
      
      // Update Google Analytics consent if gtag is available
      if (typeof gtag !== 'undefined') {
        gtag('consent', 'update', {
          'analytics_storage': preferences.analytics ? 'granted' : 'denied',
          'ad_storage': preferences.marketing ? 'granted' : 'denied',
          'functionality_storage': preferences.functional ? 'granted' : 'denied'
        });
      }
      
      // Apply preferences immediately
      applyCookiePreferences(preferences);
    }
    
    function applyCookiePreferences(preferences) {
      // Handle analytics cookies
      if (!preferences.analytics) {
        // Disable analytics tracking
        if (typeof gtag !== 'undefined') {
          gtag('config', 'GA_MEASUREMENT_ID', { 'anonymize_ip': true, 'storage': 'none' });
        }
        // Clear existing analytics cookies
        deleteCookiesByPattern('_ga');
        deleteCookiesByPattern('_gid');
        deleteCookiesByPattern('_gat');
      }
      
      // Handle Microsoft Clarity
      if (!preferences.analytics && typeof clarity !== 'undefined') {
        try {
          clarity('consent', false);
        } catch(e) {
          console.log('Could not disable Microsoft Clarity');
        }
      }
      
      // Handle functional cookies
      if (!preferences.functional) {
        // Clear functional cookies but keep essential ones
        deleteCookiesByPattern('user_preferences');
        deleteCookiesByPattern('theme');
      }
      
      // Handle marketing cookies
      if (!preferences.marketing) {
        // Clear marketing cookies
        deleteCookiesByPattern('marketing');
        deleteCookiesByPattern('ads');
      }
    }
    
    function deleteCookiesByPattern(pattern) {
      const cookies = document.cookie.split(";");
      for (let cookie of cookies) {
        const eqPos = cookie.indexOf("=");
        const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
        if (name.includes(pattern)) {
          document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=" + window.location.hostname;
          document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
        }
      }
    }

    function acceptCookies() {
      localStorage.setItem('cookieConsent', 'accepted');
      localStorage.setItem('cookieConsentDate', new Date().toISOString());
      
      // Update Google Analytics consent if gtag is available
      if (typeof gtag !== 'undefined') {
        gtag('consent', 'update', {
          'analytics_storage': 'granted'
        });
      }
      
      removeCookieBanner();
    }

    function rejectCookies() {
      localStorage.setItem('cookieConsent', 'declined');
      localStorage.setItem('cookieConsentDate', new Date().toISOString());
      
      // Update Google Analytics consent if gtag is available
      if (typeof gtag !== 'undefined') {
        gtag('consent', 'update', {
          'analytics_storage': 'denied'
        });
      }
      
      removeCookieBanner();
    }
    
    function removeCookieBanner() {
      if (cookieBanner && cookieBanner.parentNode) {
        // Add fade out animation
        cookieBanner.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
        cookieBanner.style.opacity = '0';
        cookieBanner.style.transform = 'translateY(100%)';
        
        // Remove element after animation
        setTimeout(function() {
          if (cookieBanner && cookieBanner.parentNode) {
            cookieBanner.parentNode.removeChild(cookieBanner);
          }
          cookieBanner = null;
        }, 300);
      }
    }
    
    // Global function to reopen cookie settings
    function reopenCookieSettings() {
      // Check if user has already made cookie choices
      const hasConsent = localStorage.getItem('cookieConsent');
      
      if (hasConsent) {
        // If they have existing preferences, load and show the modal directly
        if (typeof createCookieModal === 'function' && typeof showCookieModal === 'function') {
          // Create modal if it doesn't exist
          if (!cookieModal || !document.getElementById('cookie-modal')) {
            createCookieModal();
          }
          
          // Load existing preferences into the modal
          const preferences = JSON.parse(localStorage.getItem('cookiePreferences') || '{}');
          if (document.getElementById('analytics-cookies')) {
            document.getElementById('analytics-cookies').checked = preferences.analytics || false;
          }
          if (document.getElementById('functional-cookies')) {
            document.getElementById('functional-cookies').checked = preferences.functional || false;
          }
          if (document.getElementById('marketing-cookies')) {
            document.getElementById('marketing-cookies').checked = preferences.marketing || false;
          }
          
          showCookieModal();
        } else {
          alert('Cookie settings are not available on this page. Please visit the Cookie Policy page.');
        }
      } else {
        // If no consent yet, create banner and modal
        if (typeof createCookieBanner === 'function' && typeof createCookieModal === 'function') {
          createCookieBanner();
          createCookieModal();
          showCookieModal();
        } else {
          alert('Cookie settings will appear after page reload.');
          window.location.reload();
        }
      }
    }
  </script>

</head>
  <body class="d-flex flex-column h-100">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MNLSSL2G"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <header>
      <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
          <a class="navbar-brand" href="{{ url_for('main.dashboard') if current_user.is_authenticated else url_for('main.index') }}">
            <img src="{{ url_for('static', filename='HomeGrubHub.png') }}" alt="HomeGrubHub" class="navbar-logo">HomeGrubHub
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            {% if current_user.is_authenticated %}
            <ul class="navbar-nav me-auto">
              <!-- Core Navigation -->
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('main.dashboard') }}">
                  <i class="fas fa-home"></i>
                  <span class="nav-text">Dashboard</span>
                </a>
              </li>
              
              <!-- Recipe Management Dropdown -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-book"></i>
                  <span class="nav-text">Recipes</span>
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{{ url_for('main.all_recipes') }}">
                    <i class="fas fa-th-large me-2"></i>All Recipes
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.add_recipe') }}">
                    <i class="fas fa-plus-circle me-2"></i>Add Recipe
                  </a></li>
                  {% if current_user.can_access_feature('import_recipes') %}
                  <li><a class="dropdown-item" href="{{ url_for('main.import_recipe') }}">
                    <i class="fas fa-download me-2"></i>Import Recipe
                  </a></li>
                  {% endif %}
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.tags') }}">
                    <i class="fas fa-tags me-2"></i>Categories
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.ingredient_search') }}">
                    <i class="fas fa-search me-2"></i>Find by Ingredients
                  </a></li>
                </ul>
              </li>
              
              <!-- Enhanced Meal Planning with Tools -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-utensils"></i>
                  <span class="nav-text">Meal Planning</span>
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{{ url_for('meal_planning.meal_planner') }}">
                    <i class="fas fa-calendar-alt me-2"></i>Weekly Planner
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('pantry.index') }}">
                    <i class="fas fa-warehouse me-2"></i>My Pantry
                  </a></li>
                  {% if current_user.can_access_feature('pantry_tracker_predictive') %}
                  <li><a class="dropdown-item" href="{{ url_for('predictive.predictive_dashboard') }}">
                    <i class="fas fa-brain me-2"></i>Predictive Pantry
                    <span class="badge bg-primary ms-1">Pro</span>
                  </a></li>
                  {% endif %}
                  <li><a class="dropdown-item" href="{{ url_for('weekly_shopping.current_week') }}">
                    <i class="fas fa-shopping-cart me-2"></i>This Weeks Shopping List
                  </a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{{ url_for('scanner_upload.barcode_scanner_page') }}">
                    <i class="fas fa-barcode me-2"></i>Barcode Scanner
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('nutrition.nutrition_dashboard') }}">
                    <i class="fas fa-chart-line me-2"></i>Nutrition Dashboard
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('nutrition.nutrition_tracker') }}">
                    <i class="fas fa-plus-circle me-2"></i>Log Food Entry
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('fitness.fitness_dashboard') }}">
                    <i class="fas fa-heartbeat me-2"></i>Fitness & Weight Tracker
                  </a></li>
                </ul>
              </li>

              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-chart-line me-2"></i>
                  <span class="nav-text">Health & Analytics</span>
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{{ url_for('nutrition.nutrition_dashboard') }}">
                    <i class="fas fa-tachometer-alt me-2"></i>Nutrition Dashboard
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('nutrition.nutrition_tracker') }}">
                    <i class="fas fa-plus-circle me-2"></i>Log Food Entry
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('fitness.fitness_dashboard') }}">
                    <i class="fas fa-heartbeat me-2"></i>Fitness & Weight Tracker
                  </a></li>
                </ul>
              </li>

              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-shopping-cart me-2"></i>
                  <span class="nav-text">Shopping Lists</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a class="dropdown-item" href="{{ url_for('weekly_shopping.index') }}">
                      <i class="fas fa-shopping-cart me-2"></i>Shopping Lists
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{{ url_for('smart_shopping.smart_shopping_view') }}">
                      <i class="fas fa-shopping-cart me-2"></i>Price Comparison
                    </a>
                  </li>
                </ul>
              </li>

              <!-- Community Features -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-users"></i>
                  <span class="nav-text">Community</span>
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{{ url_for('community.community_home') }}">
                    <i class="fas fa-home me-2"></i>Community Home
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('community.community_recipes') }}">
                    <i class="fas fa-utensils me-2"></i>All Recipes
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('community.featured_recipes') }}">
                    <i class="fas fa-star me-2"></i>Featured Recipes
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('community.recipe_collections') }}">
                    <i class="fas fa-bookmark me-2"></i>Collections
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('community.active_challenges') }}">
                    <i class="fas fa-trophy me-2"></i>Challenges
                  </a></li>
                </ul>
              </li>
              <!-- Blogs -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-blog"></i>
                  <span class="nav-text">Blogs</span>
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{{ url_for('main.blog') }}">
                    <i class="fas fa-th-large me-2"></i>All Blogs
                  </a></li>
                </ul>
              </li>

              <!-- Family Collaboration (Family subscribers only) -->
              {% if current_user.can_access_feature('family_sharing') %}
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-users-cog"></i>
                  <span class="nav-text">Family</span>
                  <span class="badge bg-success ms-1">Family</span>
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{{ url_for('family_collab.cooking_assignments') }}">
                    <i class="fas fa-tasks me-2"></i>Cooking Assignments
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('family_collab.family_recipe_collection') }}">
                    <i class="fas fa-heart me-2"></i>Family Recipe Collection
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('family_collab.family_messages') }}">
                    <i class="fas fa-comments me-2"></i>Family Messages
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('family_collab.shopping_coordination') }}">
                    <i class="fas fa-shopping-basket me-2"></i>Shopping Coordination
                  </a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{{ url_for('family.family_dashboard') }}">
                    <i class="fas fa-home me-2"></i>Family Dashboard
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('family.manage_members') }}">
                    <i class="fas fa-cog me-2"></i>Manage Family
                  </a></li>
                </ul>
              </li>
              {% endif %}

              
            
            <!-- Right Side Navigation -->
            <ul class="navbar-nav ms-auto">
              {% if current_user.is_anonymous %}
              <!-- Anonymous User Menu -->
              <li class="nav-item">
                <a class="nav-link" href="{{ url_for('billing.pricing') }}">
                  <i class="fas fa-star"></i>
                  <span class="nav-text">Pricing</span>
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-life-ring"></i>
                  <span class="nav-text">Support</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="{{ url_for('support.help_center') }}">
                    <i class="fas fa-home me-2"></i>Help Center
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.getting_started') }}">
                    <i class="fas fa-rocket me-2"></i>Getting Started
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.faq') }}">
                    <i class="fas fa-question-circle me-2"></i>FAQ
                  </a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.contact_form') }}">
                    <i class="fas fa-envelope me-2"></i>Contact Support
                  </a></li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-file-contract"></i>
                  <span class="nav-text">Policies</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="{{ url_for('main.privacy_policy') }}">
                    <i class="fas fa-shield-alt me-2"></i>Privacy Policy
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.terms_of_service') }}">
                    <i class="fas fa-file-contract me-2"></i>Terms of Service
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.refund_policy') }}">
                    <i class="fas fa-undo me-2"></i>Refund Policy
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.cookie_policy') }}">
                    <i class="fas fa-cookie-bite me-2"></i>Cookie Policy
                  </a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="btn btn-outline-primary ms-2" href="{{ url_for('main.login') }}">
                  <i class="fas fa-sign-in-alt me-1"></i>Login
                </a>
              </li>
              {% else %}
              <!-- Authenticated User Menu -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-file-contract"></i>
                  <span class="nav-text">Policies</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="{{ url_for('main.privacy_policy') }}">
                    <i class="fas fa-shield-alt me-2"></i>Privacy Policy
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.terms_of_service') }}">
                    <i class="fas fa-file-contract me-2"></i>Terms of Service
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.cookie_policy') }}">
                    <i class="fas fa-cookie-bite me-2"></i>Cookie Policy
                  </a></li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                  <i class="fas fa-life-ring"></i>
                  <span class="nav-text">Support</span>
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="{{ url_for('support.help_center') }}">
                    <i class="fas fa-home me-2"></i>Help Center
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.getting_started') }}">
                    <i class="fas fa-rocket me-2"></i>Getting Started
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.faq') }}">
                    <i class="fas fa-question-circle me-2"></i>FAQ
                  </a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.contact_form') }}">
                    <i class="fas fa-envelope me-2"></i>Contact Support
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.create_ticket') }}">
                    <i class="fas fa-ticket-alt me-2"></i>Support Ticket
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('support.my_tickets') }}">
                    <i class="fas fa-list me-2"></i>My Tickets
                  </a></li>
                </ul>
              </li>
            </ul>
            {% endif %}
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-user-circle"></i>
                  <span class="nav-text">{{ current_user.username }}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                  <li><a class="dropdown-item" href="{{ url_for('main.profile') }}">
                    <i class="fas fa-user me-2"></i>Profile
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('billing.account') }}">
                    <i class="fas fa-credit-card me-2"></i>Account & Billing
                  </a></li>
                  <li><a class="dropdown-item" href="{{ url_for('main.favourites') }}">
                    <i class="fas fa-heart me-2"></i>My Favourites
                  </a></li>
                  
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="/logout">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                  </a></li>
                </ul>
              </li>
              {% endif %}
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main class="flex-shrink-0">
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="container mt-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
              <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'info-circle' if category == 'info' else 'check-circle' }} me-2"></i>
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      {% endwith %}
      
      {% block content %}{% endblock %}
    </main>
    <br>
    <br>

  <footer class="footer text-light">
  <div class="container">
    
    <!-- Top Row with Columns -->
    <div class="row">
      
      <!-- Company Info -->
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="d-flex align-items-center mb-3">
          <img src="{{ url_for('static', filename='HomeGrubHub.png') }}" alt="HomeGrubHub Logo" style="height: 32px; margin-right: 0.75rem;">
          <h5 class="mb-0 text-white">HomeGrubHub</h5>
        </div>
        <p class="text-light mb-3">A meal planning application designed to help you organise recipes, plan meals, and manage your cooking efficiently.</p>
        <div class="d-flex gap-3">
          <a href="https://facebook.com/homegrubhub" class="text-light" aria-label="Follow us on Facebook"><i class="fab fa-facebook-f fa-lg"></i></a>
          <a href="https://twitter.com/homegrubhub" class="text-light" aria-label="Follow us on Twitter"><i class="fab fa-twitter fa-lg"></i></a>
          <a href="https://instagram.com/homegrubhub" class="text-light" aria-label="Follow us on Instagram"><i class="fab fa-instagram fa-lg"></i></a>
          <a href="https://uk.pinterest.com/homegrubhub" class="text-light" aria-label="Follow us on Pinterest"><i class="fab fa-pinterest fa-lg"></i></a>
          <a href="https://youtube.com/homegrubhub" class="text-light" aria-label="Watch our cooking videos"><i class="fab fa-youtube fa-lg"></i></a>
        </div>
      </div>
      
      <!-- Quick Links -->
      <div class="col-lg-2 col-md-6 mb-4">
        <h6 class="text-white mb-3">Quick Links</h6>
        <ul class="list-unstyled">
          <li><a href="{{ url_for('main.recipe_categories') }}" class="text-light text-decoration-none">Recipe Categories</a></li>
          <li><a href="{{ url_for('main.search') }}" class="text-light text-decoration-none">Search Recipes</a></li>
          <li><a href="{{ url_for('meal_planning.meal_planner') }}" class="text-light text-decoration-none">Meal Planning</a></li>
          <li><a href="{{ url_for('nutrition.nutrition_log_list') }}" class="text-light text-decoration-none">Nutrition Tracker</a></li>
          <li><a href="{{ url_for('smart_shopping.smart_shopping_view') }}" class="text-light text-decoration-none">Smart Shopping</a></li>
        </ul>
      </div>
      
      <!-- Support Links -->
      <div class="col-lg-2 col-md-6 mb-4">
        <h6 class="text-white mb-3">Support</h6>
        <ul class="list-unstyled">
          <li><a href="{{ url_for('main.about') }}" class="text-light text-decoration-none">About Us</a></li>
          <li><a href="{{ url_for('support.contact_form') }}" class="text-light text-decoration-none">Contact Support</a></li>
          <li><a href="{{ url_for('support.help_center') }}" class="text-light text-decoration-none">Help Center</a></li>
          <li><a href="{{ url_for('main.blog') }}" class="text-light text-decoration-none">Blog & Tips</a></li>
          <li><a href="{{ url_for('community.community_home') }}" class="text-light text-decoration-none">Community</a></li>
        </ul>
      </div>
      
    
        <div class="col-lg-2 col-md-6 mb-4">
        <h6 class="text-white mb-3">Legal</h6>
        <ul class="list-unstyled">
          <a href="{{ url_for('main.privacy_policy') }}" class="text-light text-decoration-none small">Privacy Policy</a>
          <a href="{{ url_for('main.terms_of_service') }}" class="text-light text-decoration-none small">Terms of Service</a>
          <a href="{{ url_for('main.cookie_policy') }}" class="text-light text-decoration-none small">Cookie Policy</a>
          <a href="{{ url_for('seo.sitemap') }}" class="text-light text-decoration-none small">Sitemap</a>
        </div>
      </div>
    </div>
    
    
    <!-- Bottom Bar -->
    <hr class="my-4 border-secondary">
    <div class="row align-items-center">
      <div class="col-md-6 mb-2 mb-md-0">
        <p class="mb-0 text-light">
          ¬© 2025 HomeGrubHub Ltd. Made with <i class="fas fa-heart text-danger"></i> for food lovers in the UK.
        </p>
      </div>
  </div> <!-- /.container -->
</footer>


    <!-- jQuery (required for modals and AJAX) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Community Features -->
    <script src="{{ url_for('static', filename='js/recipe-voting.js') }}"></script>
    
    <script>
      // Auto-dismiss alerts after 5 seconds
      setTimeout(function() {
        var alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
          var bsAlert = new bootstrap.Alert(alert);
          bsAlert.close();
        });
      }, 5000);
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
      // Register service worker for PWA functionality
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('/static/sw.js', { scope: '/' })
            .then(function(registration) {
              console.log('HomeGrubHub PWA: Service Worker registered successfully:', registration.scope);
              
              // Check for updates
              registration.addEventListener('updatefound', function() {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', function() {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New update available
                    if (confirm('A new version of HomeGrubHub is available. Refresh to update?')) {
                      window.location.reload();
                    }
                  }
                });
              });
            })
            .catch(function(error) {
              console.log('HomeGrubHub PWA: Service Worker registration failed:', error);
            });
        });
      }
      
      // PWA Install Banner
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', function(e) {
        e.preventDefault();
        deferredPrompt = e;
        
        // Show custom install banner
        const installBanner = document.createElement('div');
        installBanner.className = 'alert alert-info alert-dismissible fade show position-fixed bottom-0 start-50 translate-middle-x mb-3';
        installBanner.style.zIndex = '9999';
        installBanner.style.maxWidth = '400px';
        installBanner.innerHTML = `
          <div class="d-flex align-items-center">
            <i class="fas fa-mobile-alt me-2"></i>
            <div class="flex-grow-1">
              <strong>Install HomeGrubHub</strong><br>
              <small>Get the full app experience!</small>
            </div>
            <button class="btn btn-primary btn-sm ms-2" onclick="installPWA()" id="installBtn">
              Install
            </button>
            <button type="button" class="btn-close ms-2" data-bs-dismiss="alert"></button>
          </div>
        `;
        document.body.appendChild(installBanner);
        
        // Auto-hide after 10 seconds
        setTimeout(() => {
          if (installBanner.parentNode) {
            installBanner.remove();
          }
        }, 10000);
      });
      
      // Install PWA function
      function installPWA() {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then(function(choiceResult) {
            if (choiceResult.outcome === 'accepted') {
              console.log('HomeGrubHub PWA: User accepted the install prompt');
            } else {
              console.log('HomeGrubHub PWA: User dismissed the install prompt');
            }
            deferredPrompt = null;
          });
        }
      }
      
      // Detect if running as PWA
      if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
        console.log('HomeGrubHub PWA: Running as installed PWA');
        document.documentElement.setAttribute('data-pwa', 'true');
      }
      
      // Online/offline status
      function updateOnlineStatus() {
        const isOnline = navigator.onLine;
        document.documentElement.setAttribute('data-online', isOnline.toString());
        
        if (!isOnline) {
          // Show offline indicator
          const offlineIndicator = document.createElement('div');
          offlineIndicator.id = 'offline-indicator';
          offlineIndicator.className = 'alert alert-warning position-fixed top-0 start-50 translate-middle-x mt-3';
          offlineIndicator.style.zIndex = '9999';
          offlineIndicator.innerHTML = `
            <i class="fas fa-wifi-slash me-2"></i>
            You're offline. Some features may be limited.
          `;
          document.body.appendChild(offlineIndicator);
        } else {
          // Remove offline indicator
          const indicator = document.getElementById('offline-indicator');
          if (indicator) {
            indicator.remove();
          }
        }
      }
      
      window.addEventListener('online', updateOnlineStatus);
      window.addEventListener('offline', updateOnlineStatus);
      updateOnlineStatus(); // Check initial status
    </script>
    
    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
        console.log('üöÄ Starting Tawk.to INLINE widget with Property ID: 1j20elokk');
        
        var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
        
        // Enhanced callbacks for HomeGrubHub
        Tawk_API.onLoad = function(){
            console.log('‚úÖ Tawk.to inline chat widget loaded successfully!');
            {% if current_user.is_authenticated %}
                try {
                    Tawk_API.setAttributes({
                        'name': '{{ current_user.username }}',
                        'email': '{{ current_user.email }}',
                        'hash': 'user-{{ current_user.id }}'
                    }, function(error){
                        if (error) {
                            console.error('Error setting user attributes:', error);
                        } else {
                            console.log('‚úÖ User attributes set for {{ current_user.username }}');
                        }
                    });
                } catch (e) {
                    console.error('Error in setAttributes:', e);
                }
            {% endif %}
        };
        
        Tawk_API.onStatusChange = function(status){
            console.log('üìä Tawk.to status:', status);
        };
        
        Tawk_API.onChatMaximized = function(){
            console.log('üí¨ Chat opened');
        };
        
        Tawk_API.onChatMinimized = function(){
            console.log('üìù Chat minimized');
        };
        
        // Load the inline widget script
        (function(){
            var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
            s1.async=true;
            s1.src='https://embed.tawk.to/68939fef30a43819230401d2/1j20elokk';
            s1.charset='UTF-8';
            s1.setAttribute('crossorigin','*');
            
            s1.onload = function() {
                console.log('‚úÖ Tawk.to inline widget script loaded successfully');
            };
            
            s1.onerror = function(error) {
                console.error('‚ùå Failed to load Tawk.to script:', error);
            };
            
            s0.parentNode.insertBefore(s1,s0);
        })();
    </script>
    <!--End of Tawk.to Script-->
  </body>
</html>
