{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Admin Sidebar -->
    <div class="col-md-3 col-lg-2 bg-light sidebar">
      <div class="position-sticky pt-3">
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
          <span><i class="fas fa-tools me-1"></i>Admin Panel</span>
        </h6>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link {{ 'active' if request.endpoint == 'admin.dashboard' else '' }}" href="{{ url_for('admin.dashboard') }}">
              <i class="fas fa-tachometer-alt me-2"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {{ 'active' if 'users' in request.endpoint else '' }}" href="{{ url_for('admin.users') }}">
              <i class="fas fa-users me-2"></i>Manage Users
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {{ 'active' if 'recipes' in request.endpoint else '' }}" href="{{ url_for('admin.recipes') }}">
              <i class="fas fa-utensils me-2"></i>Manage Recipes
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {{ 'active' if request.endpoint == 'admin.settings' else '' }}" href="{{ url_for('admin.settings') }}">
              <i class="fas fa-cog me-2"></i>Settings
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link {{ 'active' if request.endpoint == 'admin.system_info' else '' }}" href="{{ url_for('admin.system_info') }}">
              <i class="fas fa-info-circle me-2"></i>System Info
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('main.admin_analytics') }}">
              <i class="fas fa-chart-bar me-2"></i>Analytics
            </a>
          </li>
        </ul>
        
        <hr>
        
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="{{ url_for('main.index') }}">
              <i class="fas fa-arrow-left me-2"></i>Back to Site
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <!-- Main Content -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group me-2">
            <span class="badge bg-primary">Admin: {{ current_user.username }}</span>
          </div>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="row">
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Users</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_users }}</div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-users fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total Recipes</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_recipes }}</div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-utensils fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Categories</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_tags }}</div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-tags fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Admin Users</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ admin_users }}</div>
                </div>
                <div class="col-auto">
                  <i class="fas fa-user-shield fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="row">
        <div class="col-lg-6">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Recent Users</h6>
            </div>
            <div class="card-body">
              {% if recent_users %}
                {% for user in recent_users %}
                <div class="d-flex align-items-center border-bottom py-2">
                  <div class="flex-shrink-0">
                    <i class="fas fa-user-circle fa-2x {{ 'text-warning' if user.is_admin else 'text-primary' }}"></i>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <div class="fw-bold">{{ user.username }}</div>
                    <div class="text-muted small">{{ user.email }}</div>
                    <div class="text-muted small">Joined: {{ user.created_at.strftime('%Y-%m-%d') }}</div>
                  </div>
                  {% if user.is_admin %}
                  <span class="badge bg-warning">Admin</span>
                  {% endif %}
                </div>
                {% endfor %}
              {% else %}
                <p class="text-muted">No users found.</p>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Recent Recipes</h6>
            </div>
            <div class="card-body">
              {% if recent_recipes %}
                {% for recipe in recent_recipes %}
                <div class="d-flex align-items-center border-bottom py-2">
                  <div class="flex-shrink-0">
                    <i class="fas fa-utensils fa-2x text-success"></i>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <div class="fw-bold">{{ recipe.title }}</div>
                    <div class="text-muted small">By: {{ recipe.user.username }}</div>
                    <div class="text-muted small">Created: {{ recipe.created_at.strftime('%Y-%m-%d') }}</div>
                  </div>
                  <a href="{{ url_for('main.recipe', recipe_id=recipe.id) }}" class="btn btn-sm btn-outline-primary">View</a>
                </div>
                {% endfor %}
              {% else %}
                <p class="text-muted">No recipes found.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<style>
.sidebar {
  position: fixed;
  top: 0;
  bottom: 0;
  left: 0;
  z-index: 100;
  padding: 48px 0 0;
  box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
}

.sidebar .nav-link {
  font-weight: 500;
  color: #333;
}

.sidebar .nav-link.active {
  color: var(--primary-color);
  background-color: rgba(0, 123, 255, .1);
}

.border-left-primary {
  border-left: 0.25rem solid var(--primary-color) !important;
}

.border-left-success {
  border-left: 0.25rem solid var(--success-color) !important;
}

.border-left-info {
  border-left: 0.25rem solid #17a2b8 !important;
}

.border-left-warning {
  border-left: 0.25rem solid var(--warning-color) !important;
}

@media (max-width: 767.98px) {
  .sidebar {
    position: static;
    padding: 0;
  }
}
</style>
{% endblock %}
