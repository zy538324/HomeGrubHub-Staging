{% extends "base.html" %}
{% block title %}Parental Controls - HomeGrubHub{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">Parental Controls</h1>
        <a href="{{ url_for('family.family_dashboard') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
        </a>
    </div>

    {% if children %}
        {% for child in children %}
        <div class="card mb-4">
            <div class="card-header">
                <strong>{{ child.display_name or child.user.username }}</strong>
            </div>
            <div class="card-body">
                <form method="post" action="{{ url_for('parental_controls.update_parental_control', child_id=child.id) }}">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Screen Time Limit (minutes)</label>
                            <input type="number" class="form-control" name="screen_time_limit" value="{{ controls.get(child.id).screen_time_limit if controls.get(child.id) else '' }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Allowed Start</label>
                            <input type="time" class="form-control" name="allowed_hours_start" value="{{ controls.get(child.id).allowed_hours_start if controls.get(child.id) else '' }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Allowed End</label>
                            <input type="time" class="form-control" name="allowed_hours_end" value="{{ controls.get(child.id).allowed_hours_end if controls.get(child.id) else '' }}">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Content Filter Level</label>
                            {% set level = controls.get(child.id).content_filter_level if controls.get(child.id) else 'moderate' %}
                            <select class="form-select" name="content_filter_level">
                                <option value="strict" {% if level == 'strict' %}selected{% endif %}>Strict</option>
                                <option value="moderate" {% if level == 'moderate' %}selected{% endif %}>Moderate</option>
                                <option value="relaxed" {% if level == 'relaxed' %}selected{% endif %}>Relaxed</option>
                            </select>
                        </div>
                        <div class="col-md-8">
                            <div class="form-check mt-4">
                                <input type="checkbox" class="form-check-input" id="meal{{ child.id }}" name="requires_meal_approval" {% if controls.get(child.id) and controls.get(child.id).requires_meal_approval %}checked{% endif %}>
                                <label class="form-check-label" for="meal{{ child.id }}">Require meal approval</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="shop{{ child.id }}" name="requires_shopping_approval" {% if controls.get(child.id) and controls.get(child.id).requires_shopping_approval %}checked{% endif %}>
                                <label class="form-check-label" for="shop{{ child.id }}">Require shopping approval</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="challenge{{ child.id }}" name="requires_challenge_approval" {% if controls.get(child.id) and controls.get(child.id).requires_challenge_approval %}checked{% endif %}>
                                <label class="form-check-label" for="challenge{{ child.id }}">Require challenge approval</label>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Settings</button>
                </form>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">No child members found in this family.</p>
    {% endif %}
</div>
{% endblock %}

