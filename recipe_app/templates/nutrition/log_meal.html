{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h1>Log a Meal</h1>
  <form id="mealForm" method="POST" action="{{ url_for('nutrition.log_meal') }}" class="mt-3">
    {{ form.hidden_tag() }}
    <div class="mb-3">
      {{ form.meal_type.label(class="form-label") }}
      {{ form.meal_type(class="form-select") }}
    </div>
    <div class="mb-3">
      {{ form.meal_date.label(class="form-label") }}
      {{ form.meal_date(class="form-control") }}
    </div>
    <div class="mb-3">
      {{ form.food_ids.label(class="form-label") }}
      {{ form.food_ids(id='foods', class='form-select') }}
    </div>
    {{ form.submit(class='btn btn-primary') }}
  </form>
  <div id="mealTotals" class="mt-4">
    <h3>Meal Totals</h3>
    <p>Calories: <span id="totalCalories">0</span></p>
    <p>Protein: <span id="totalProtein">0</span></p>
    <p>Carbs: <span id="totalCarbs">0</span></p>
    <p>Fat: <span id="totalFat">0</span></p>
  </div>
</div>
<script>
// JS to update meal totals when foods are selected
const foodsData = {{ foods|tojson|safe }};
document.getElementById('foods').addEventListener('change', function() {
    let selected = Array.from(this.selectedOptions).map(opt => parseInt(opt.value));
    let totals = {calories: 0, protein: 0, carbs: 0, fat: 0};
    foodsData.forEach(food => {
        if (selected.includes(food.id)) {
            totals.calories += food.calories;
            totals.protein += food.protein;
            totals.carbs += food.carbs;
            totals.fat += food.fat;
        }
    });
    document.getElementById('totalCalories').textContent = totals.calories;
    document.getElementById('totalProtein').textContent = totals.protein;
    document.getElementById('totalCarbs').textContent = totals.carbs;
    document.getElementById('totalFat').textContent = totals.fat;
});
</script>
{% endblock %}
