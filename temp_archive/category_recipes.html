{% extends "base.html" %}

{% block content %}
<div class="container">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Home</a></li>
      <li class="breadcrumb-item"><a href="{{ url_for('main.tags') }}">Categories</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{ category.name }}</li>
    </ol>
  </nav>

  <!-- Category Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex align-items-center mb-3">
        <div class="category-icon me-3" style="color: {{ category.color_code }}">
          <i class="{{ category.icon }} fa-2x"></i>
        </div>
        <div>
          <h1 class="mb-1">{{ category.name }}</h1>
          <p class="text-muted mb-0">{{ category.description }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Recipe Count -->
  <div class="row mb-4">
    <div class="col-12">
      <p class="text-muted">
        <i class="fas fa-utensils me-2"></i>
        {{ recipes.total }} recipe{{ 's' if recipes.total != 1 else '' }} found
      </p>
    </div>
  </div>

  <!-- Recipes Grid -->
  {% if recipes.items %}
  <div class="row g-4">
    {% for recipe in recipes.items %}
    <div class="col-lg-4 col-md-6">
      <div class="card h-100 shadow-sm recipe-card">
        {% if recipe.image_filename %}
        <img src="{{ url_for('static', filename='uploads/' + recipe.image_filename) }}" 
             class="card-img-top" alt="{{ recipe.title }}" style="height: 200px; object-fit: cover;">
        {% else %}
        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
          <i class="fas fa-utensils fa-3x text-muted"></i>
        </div>
        {% endif %}
        
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">
            <a href="{{ url_for('main.recipe', recipe_id=recipe.id) }}" class="text-decoration-none">
              {{ recipe.title }}
            </a>
          </h5>
          
          <p class="card-text text-muted small flex-grow-1">
            {{ recipe.description[:100] }}{% if recipe.description|length > 100 %}...{% endif %}
          </p>
          
          <div class="recipe-meta mt-auto">
            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted">
                <i class="fas fa-clock me-1"></i>
                {{ recipe.prep_time + recipe.cook_time if recipe.prep_time and recipe.cook_time else 'N/A' }} min
              </small>
              <small class="text-muted">
                <i class="fas fa-users me-1"></i>
                {{ recipe.servings or 'N/A' }} servings
              </small>
            </div>
            {% if recipe.cuisine_type %}
            <small class="text-muted d-block mt-1">
              <i class="fas fa-globe me-1"></i>
              {{ recipe.cuisine_type }}
            </small>
            {% endif %}
          </div>
        </div>
        
        <div class="card-footer bg-transparent">
          <small class="text-muted">
            By {{ recipe.user.username }} â€¢ {{ recipe.created_at.strftime('%b %d, %Y') }}
          </small>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if recipes.pages > 1 %}
  <nav aria-label="Recipe pagination" class="mt-5">
    <ul class="pagination justify-content-center">
      {% if recipes.has_prev %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('main.category_recipes', category_id=category.id, page=recipes.prev_num) }}">
          <i class="fas fa-chevron-left"></i> Previous
        </a>
      </li>
      {% endif %}
      
      {% for page_num in recipes.iter_pages() %}
        {% if page_num %}
          {% if page_num != recipes.page %}
          <li class="page-item">
            <a class="page-link" href="{{ url_for('main.category_recipes', category_id=category.id, page=page_num) }}">{{ page_num }}</a>
          </li>
          {% else %}
          <li class="page-item active">
            <span class="page-link">{{ page_num }}</span>
          </li>
          {% endif %}
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">...</span>
        </li>
        {% endif %}
      {% endfor %}
      
      {% if recipes.has_next %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('main.category_recipes', category_id=category.id, page=recipes.next_num) }}">
          Next <i class="fas fa-chevron-right"></i>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

  {% else %}
  <!-- Empty State -->
  <div class="text-center py-5">
    <div class="mb-4">
      <i class="{{ category.icon }} fa-4x text-muted"></i>
    </div>
    <h3 class="text-muted">No recipes found</h3>
    <p class="text-muted">There are no recipes in this category yet.</p>
    <a href="{{ url_for('main.add_recipe') }}" class="btn btn-primary">
      <i class="fas fa-plus me-2"></i>Add First Recipe
    </a>
  </div>
  {% endif %}
</div>

<style>
.recipe-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.recipe-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.category-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 60px;
  height: 60px;
}
</style>
{% endblock %}
