{% extends "base.html" %}

{% block content %}
<div class="container">
  <h1>Recipe Method Debug</h1>
  
  <div class="card">
    <div class="card-header">
      <h4>Debug Info</h4>
    </div>
    <div class="card-body">
      <p><strong>Recipe Title:</strong> {{ recipe.title }}</p>
      <p><strong>Method exists:</strong> {{ recipe.method is not none }}</p>
      <p><strong>Method length:</strong> {{ recipe.method|length if recipe.method else 0 }}</p>
      
      {% if recipe.method %}
      {% set method_text = recipe.method.strip() %}
      {% if method_text %}
      <p><strong>Method text length:</strong> {{ method_text|length }}</p>
      <p><strong>Has newlines:</strong> {{ '\n' in method_text }}</p>
      <p><strong>Has carriage returns:</strong> {{ '\r' in method_text }}</p>
      
      {% set method_text_normalized = method_text.replace('\r\n', '\n').replace('\r', '\n') %}
      <p><strong>Normalized method has newlines:</strong> {{ '\n' in method_text_normalized }}</p>
      
      {% if '\n' in method_text_normalized %}
      {% set method_lines = method_text_normalized.split('\n') %}
      <p><strong>Number of lines:</strong> {{ method_lines|length }}</p>
      
      <h5>Processed Steps:</h5>
      {% set step_count = 0 %}
      {% for step in method_lines %}
      {% set step_clean = step.strip() %}
      {% if step_clean %}
        {% set step_count = step_count + 1 %}
        <div class="alert alert-info">
          <strong>Step {{ step_count }}:</strong> {{ step_clean }}
        </div>
      {% endif %}
      {% endfor %}
      
      <h5>HTML Output:</h5>
      <div class="border p-3">
        {% set step_count = 0 %}
        {% for step in method_lines %}
        {% set step_clean = step.strip() %}
        {% if step_clean %}
          {% set step_count = step_count + 1 %}
          <div class="step-item d-flex mb-4">
            <div class="step-number bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" 
                 style="width: 40px; height: 40px; min-width: 40px;">
              {{ step_count }}
            </div>
            <div class="step-content">
              <p class="mb-0 lh-lg">{{ step_clean }}</p>
            </div>
          </div>
        {% endif %}
        {% endfor %}
      </div>
      
      {% else %}
      <p><strong>No newlines found - single block method</strong></p>
      {% endif %}
      
      {% else %}
      <p><strong>Method text is empty after strip</strong></p>
      {% endif %}
      {% else %}
      <p><strong>No method data</strong></p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
